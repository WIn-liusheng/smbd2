<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SNæ‰«ææ¯”å¯¹å·¥å…·</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„html5-qrcodeåº“ç‰ˆæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        :root {
            --primary-color: #1890ff;
            --success-color: #52c41a;
            --error-color: #ff4d4f;
            --warning-color: #faad14;
            --text-primary: #333;
            --text-secondary: #666;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #e8e8e8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        /* ä¼˜åŒ–å¸ƒå±€ - ç§»åŠ¨ç«¯ä¼˜å…ˆ */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        /* ç§»åŠ¨ç«¯é¡¶éƒ¨æ  */
        .mobile-header {
            display: none;
            background: linear-gradient(135deg, var(--primary-color) 0%, #096dd9 100%);
            color: white;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .mobile-header h1 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ - å·¦å³å¸ƒå±€ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            width: 100%;
        }
        
        /* å·¦ä¾§æ•°æ®æºåŒºåŸŸ - ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º */
        .data-panel {
            width: 35%;
            min-width: 300px;
            max-width: 450px;
            background-color: var(--card-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        /* å³ä¾§æ‰«æåŒºåŸŸ */
        .scan-panel {
            flex: 1;
            background-color: var(--card-bg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* é¢æ¿æ ‡é¢˜ */
        .panel-header {
            padding: 16px 20px;
            background-color: rgba(0, 0, 0, 0.02);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h2 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* ä¸Šä¼ åŒºåŸŸä¼˜åŒ– - ç§»åŠ¨ç«¯æ›´ç´§å‡‘ */
        .upload-section {
            margin-bottom: 20px;
        }
        
        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #fafafa;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(24, 144, 255, 0.04);
        }
        
        .upload-area i {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .upload-area h3 {
            font-size: 15px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .upload-area p {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .file-input {
            display: none;
        }
        
        /* æ–‡ä»¶åˆ—è¡¨ä¼˜åŒ– */
        .file-list {
            margin-top: 15px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
            font-size: 13px;
        }
        
        .file-item i {
            color: var(--primary-color);
            font-size: 16px;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .file-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }
        
        .file-name {
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-size {
            color: var(--text-secondary);
            font-size: 11px;
        }
        
        /* SNåˆ—è¡¨ä¼˜åŒ– */
        .sn-list {
            margin-top: 20px;
        }
        
        .sn-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sn-list-header h3 {
            font-size: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .sn-count {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .sn-items {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #fafafa;
        }
        
        .sn-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            font-size: 13px;
        }
        
        .sn-item:last-child {
            border-bottom: none;
        }
        
        .sn-item i {
            margin-right: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .sn-text {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #096dd9;
        }
        
        .btn-secondary {
            background-color: #f0f2f5;
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background-color: #e0e2e5;
        }
        
        .btn-danger {
            background-color: var(--error-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d9363e;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #389e0d;
        }
        
        .btn-icon {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-secondary);
        }
        
        .btn-icon:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* æ‰«ææ¨¡å¼åˆ‡æ¢ä¼˜åŒ– */
        .scan-mode-tabs {
            display: flex;
            margin-bottom: 16px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            background-color: #f8f9fa;
        }
        
        .scan-mode-tab {
            flex: 1;
            padding: 10px 12px;
            text-align: center;
            background-color: transparent;
            border: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .scan-mode-tab:hover {
            background-color: #e6f7ff;
        }
        
        .scan-mode-tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* æ‰«æè¾“å…¥åŒºåŸŸä¼˜åŒ– */
        .scan-input-section {
            margin-bottom: 16px;
        }
        
        .scan-input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .scan-input-header h3 {
            font-size: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .scan-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success-color);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .scan-input-wrapper {
            position: relative;
            margin-bottom: 10px;
        }
        
        .scan-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: border-color 0.3s;
            background-color: #fafafa;
        }
        
        .scan-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
        }
        
        .scan-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 12px;
        }
        
        .scan-hint i {
            color: var(--primary-color);
            font-size: 14px;
        }
        
        /* æ‘„åƒå¤´åŒºåŸŸä¼˜åŒ– - æé«˜æ‰«æé€Ÿåº¦ */
        .camera-container {
            margin-top: 16px;
            border-radius: 8px;
            overflow: hidden;
            display: none;
            position: relative;
            border: 1px solid var(--primary-color);
            background-color: #000;
        }
        
        #camera-preview {
            width: 100%;
            height: 250px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 220px;
            height: 120px;
            border: 2px solid var(--success-color);
            border-radius: 8px;
            box-shadow: 0 0 0 500px rgba(0, 0, 0, 0.7);
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--success-color);
            animation: scanLine 1.5s infinite linear;
            box-shadow: 0 0 10px var(--success-color);
        }
        
        @keyframes scanLine {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .camera-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .camera-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 12px;
        }
        
        .camera-info i {
            color: var(--primary-color);
        }
        
        /* è®¾ç½®åŒºåŸŸä¼˜åŒ– */
        .settings-section {
            margin-top: 20px;
            padding: 16px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .settings-section h4 {
            font-size: 14px;
            margin-bottom: 12px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .setting-label {
            color: var(--text-secondary);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 22px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        /* ç»“æœåŒºåŸŸä¼˜åŒ– */
        .results-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .results-header h3 {
            font-size: 15px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .results-stats {
            display: flex;
            gap: 16px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: 600;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .pass-count {
            color: var(--success-color);
        }
        
        .fail-count {
            color: var(--error-color);
        }
        
        .results-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #fafafa;
            margin-bottom: 16px;
        }
        
        .result-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .result-item:hover {
            background-color: #f0f7ff;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-status {
            width: 44px;
            height: 44px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .result-status.pass {
            background-color: rgba(82, 196, 26, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(82, 196, 26, 0.3);
        }
        
        .result-status.fail {
            background-color: rgba(255, 77, 79, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(255, 77, 79, 0.3);
        }
        
        .result-details {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }
        
        .result-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .result-sn {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 10px;
        }
        
        .result-text {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
            padding: 2px 8px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .result-text.pass {
            color: var(--success-color);
            background-color: rgba(82, 196, 26, 0.1);
        }
        
        .result-text.fail {
            color: var(--error-color);
            background-color: rgba(255, 77, 79, 0.1);
        }
        
        .result-time {
            color: var(--text-secondary);
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .result-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        /* è¯­è¨€åˆ‡æ¢å™¨ */
        .language-switcher {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 100;
        }
        
        .lang-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }
        
        .lang-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .lang-options {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 5px;
            min-width: 100px;
            display: none;
            border: 1px solid var(--border-color);
        }
        
        .lang-options.show {
            display: block;
        }
        
        .lang-option {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            transition: background-color 0.2s;
            font-size: 13px;
        }
        
        .lang-option:hover {
            background-color: #f0f2f5;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 36px;
            margin-bottom: 12px;
            color: #d9d9d9;
        }
        
        .empty-state p {
            font-size: 13px;
        }
        
        /* æ“ä½œæŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: 12px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }
        
        .close-btn:hover {
            background-color: #f0f0f0;
        }
        
        .sn-preview {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 12px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .sn-preview-item {
            padding: 4px 0;
        }
        
        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 16px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: fadeInUp 0.3s ease, fadeOutDown 0.3s ease 2.5s forwards;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 90%;
            text-align: center;
            font-size: 13px;
        }
        
        .toast.success {
            background-color: var(--success-color);
        }
        
        .toast.error {
            background-color: var(--error-color);
        }
        
        .toast.warning {
            background-color: var(--warning-color);
        }
        
        .toast.info {
            background-color: var(--primary-color);
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        
        @keyframes fadeOutDown {
            from { opacity: 1; transform: translate(-50%, 0); }
            to { opacity: 0; transform: translate(-50%, 20px); }
        }
        
        /* é‡å¤æ‰«ææç¤º */
        .duplicate-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: 6px;
            background-color: var(--warning-color);
            color: #fff;
            font-weight: 500;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* æ‘„åƒå¤´é”™è¯¯æç¤º */
        .camera-error {
            background-color: rgba(255, 77, 79, 0.1);
            border: 1px solid var(--error-color);
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            text-align: center;
        }
        
        .camera-error i {
            color: var(--error-color);
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .camera-error p {
            color: var(--error-color);
            font-size: 13px;
            margin-bottom: 10px;
        }
        
        /* è¯­éŸ³æµ‹è¯•æŒ‰é’® */
        .voice-test-btn {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }
        
        .voice-test-btn .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .voice-test-btn .btn-sm:hover {
            opacity: 0.9;
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .data-panel {
                width: 40%;
                min-width: 280px;
            }
            
            .scan-frame {
                width: 200px;
                height: 110px;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
            }
            
            .mobile-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .main-content {
                flex-direction: column;
                height: calc(100vh - 56px);
            }
            
            .data-panel {
                width: 100%;
                max-width: 100%;
                height: 40%;
                min-height: 40%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .scan-panel {
                height: 60%;
                min-height: 60%;
            }
            
            .panel-content {
                padding: 12px;
            }
            
            .upload-area {
                padding: 15px 12px;
            }
            
            .upload-area h3 {
                font-size: 14px;
            }
            
            .upload-area p {
                font-size: 11px;
            }
            
            .scan-frame {
                width: 180px;
                height: 100px;
            }
            
            #camera-preview {
                height: 200px;
            }
            
            .result-text {
                font-size: 18px;
                padding: 2px 6px;
            }
            
            .result-status {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .language-switcher {
                top: 12px;
                right: 12px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .results-stats {
                gap: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .data-panel {
                height: 35%;
                min-height: 35%;
            }
            
            .scan-panel {
                height: 65%;
                min-height: 65%;
            }
            
            .upload-area {
                padding: 12px 10px;
            }
            
            .upload-area i {
                font-size: 32px;
            }
            
            .scan-frame {
                width: 160px;
                height: 90px;
            }
            
            #camera-preview {
                height: 180px;
            }
            
            .action-buttons {
                gap: 8px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .result-sn {
                font-size: 13px;
            }
            
            .result-text {
                font-size: 16px;
            }
            
            .panel-header {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨æ  -->
    <div class="mobile-header">
        <h1><i class="fas fa-barcode"></i> SNæ‰«ææ¯”å¯¹å·¥å…·</h1>
        <div class="language-switcher">
            <div class="lang-btn" id="currentLangBtn">
                <i class="fas fa-globe"></i>
                <span id="currentLangText">ä¸­æ–‡</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="lang-options" id="langOptions">
                <div class="lang-option" data-lang="zh">
                    <span>ğŸ‡¨ğŸ‡³</span>
                    <span>ä¸­æ–‡</span>
                </div>
                <div class="lang-option" data-lang="vi">
                    <span>ğŸ‡»ğŸ‡³</span>
                    <span>Tiáº¿ng Viá»‡t</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <div class="main-content">
            <!-- å·¦ä¾§æ•°æ®æºåŒºåŸŸ -->
            <div class="data-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-database"></i> <span data-i18n="dataSource">æ•°æ®æºç®¡ç†</span></h2>
                </div>
                <div class="panel-content">
                    <div class="upload-section">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3 data-i18n="uploadTitle">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ </h3>
                            <p data-i18n="uploadFormat">æ”¯æŒ.txtã€.csvæ–‡ä»¶æ ¼å¼</p>
                            <p data-i18n="uploadHint">æ¯è¡Œä¸€ä¸ªSNï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡10MB</p>
                            <input type="file" class="file-input" id="fileInput" accept=".txt,.csv">
                        </div>
                    </div>
                    
                    <div class="file-list" id="fileList">
                        <!-- å·²ä¸Šä¼ æ–‡ä»¶å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                    
                    <div class="sn-list">
                        <div class="sn-list-header">
                            <h3><i class="fas fa-list-ul"></i> <span data-i18n="snList">SNåˆ—è¡¨</span> <span class="sn-count" id="snCount">0</span></h3>
                            <button class="btn btn-secondary btn-sm" id="clearDataBtn">
                                <i class="fas fa-trash-alt"></i> <span data-i18n="clearData">æ¸…ç©º</span>
                            </button>
                        </div>
                        
                        <div class="sn-items" id="snItems">
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <p data-i18n="noData">æš‚æ— æ•°æ®ï¼Œè¯·å…ˆä¸Šä¼ æ–‡ä»¶</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§æ‰«æåŒºåŸŸ -->
            <div class="scan-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-barcode"></i> <span data-i18n="scanWindow">æ‰«æçª—å£</span></h2>
                    <div class="scan-status">
                        <div class="status-indicator"></div>
                        <span id="statusText" data-i18n="ready">å°±ç»ª</span>
                    </div>
                </div>
                <div class="panel-content">
                    <!-- æ‰«ææ¨¡å¼åˆ‡æ¢ -->
                    <div class="scan-mode-tabs">
                        <button class="scan-mode-tab active" data-mode="manual" id="manualModeBtn">
                            <i class="fas fa-keyboard"></i>
                            <span data-i18n="manualInput">æ‰‹åŠ¨/æ‰«ç æª</span>
                        </button>
                        <button class="scan-mode-tab" data-mode="camera" id="cameraModeBtn">
                            <i class="fas fa-camera"></i>
                            <span data-i18n="cameraScan">æ‘„åƒå¤´æ‰«æ</span>
                        </button>
                    </div>
                    
                    <!-- æ‰‹åŠ¨è¾“å…¥åŒºåŸŸ -->
                    <div class="scan-input-section">
                        <div class="scan-input-wrapper">
                            <input type="text" class="scan-input" id="scanInput" placeholder="è¯·ä½¿ç”¨æ‰«ç æªæ‰«æSNæˆ–æ‰‹åŠ¨è¾“å…¥" autofocus>
                        </div>
                        <div class="scan-hint">
                            <i class="fas fa-lightbulb"></i>
                            <span data-i18n="scanHint">æç¤ºï¼šæ‰«æåæŒ‰å›è½¦é”®ç¡®è®¤ï¼Œæˆ–ä½¿ç”¨æ‰«ç æªè‡ªåŠ¨è¾“å…¥</span>
                        </div>
                    </div>
                    
                    <!-- æ‘„åƒå¤´æ‰«æåŒºåŸŸ -->
                    <div class="camera-container" id="cameraContainer">
                        <div id="camera-preview">
                            <div class="camera-overlay">
                                <div class="scan-frame">
                                    <div class="scan-line"></div>
                                </div>
                            </div>
                            <div id="camera-status" style="z-index: 2; text-align: center; color: white;">
                                <i class="fas fa-camera" style="font-size: 36px; margin-bottom: 12px;"></i>
                                <p data-i18n="cameraLoading">æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´...</p>
                            </div>
                        </div>
                        <div class="camera-controls">
                            <div class="camera-info">
                                <i class="fas fa-info-circle"></i>
                                <span data-i18n="cameraHint">å°†æ¡å½¢ç /äºŒç»´ç å¯¹å‡†æ‰«ææ¡†</span>
                            </div>
                            <button class="btn btn-danger btn-sm" id="stopCameraBtn">
                                <i class="fas fa-stop-circle"></i>
                                <span data-i18n="stopCamera">åœæ­¢</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- è®¾ç½®åŒºåŸŸ -->
                    <div class="settings-section">
                        <h4><i class="fas fa-cog"></i> <span data-i18n="scanSettings">æ‰«æè®¾ç½®</span></h4>
                        <div class="setting-item">
                            <span class="setting-label" data-i18n="preventDuplicate">ç¦æ­¢é‡å¤æ‰«æ</span>
                            <label class="switch">
                                <input type="checkbox" id="preventDuplicateSwitch" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label" data-i18n="voiceAlert">è¯­éŸ³æ’­æŠ¥</span>
                            <label class="switch">
                                <input type="checkbox" id="voiceSwitch" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label" data-i18n="highSpeedScan">é«˜é€Ÿæ‰«ææ¨¡å¼</span>
                            <label class="switch">
                                <input type="checkbox" id="highSpeedSwitch" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <!-- è¯­éŸ³æµ‹è¯•æŒ‰é’® -->
                        <div class="voice-test-btn" id="voiceTestBtn">
                            <button class="btn btn-success btn-sm" id="testVoicePassBtn">
                                <i class="fas fa-volume-up"></i> æµ‹è¯•PASS
                            </button>
                            <button class="btn btn-danger btn-sm" id="testVoiceFailBtn">
                                <i class="fas fa-volume-up"></i> æµ‹è¯•FAIL
                            </button>
                            <button class="btn btn-warning btn-sm" id="testVoiceDuplicateBtn">
                                <i class="fas fa-volume-up"></i> æµ‹è¯•é‡å¤
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç»“æœåŒºåŸŸ -->
                    <div class="results-section">
                        <div class="results-header">
                            <h3><i class="fas fa-history"></i> <span data-i18n="scanResults">æ‰«æç»“æœ</span></h3>
                            <div class="results-stats">
                                <div class="stat">
                                    <div class="stat-value" id="totalScanned">0</div>
                                    <div class="stat-label" data-i18n="total">æ€»è®¡</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value pass-count" id="passCount">0</div>
                                    <div class="stat-label">PASS</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value fail-count" id="failCount">0</div>
                                    <div class="stat-label">FAIL</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-list" id="resultsList">
                            <div class="empty-state">
                                <i class="fas fa-barcode"></i>
                                <p data-i18n="noResults">æš‚æ— æ‰«æç»“æœ</p>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-secondary" id="clearResultsBtn">
                                <i class="fas fa-trash-alt"></i> <span data-i18n="clearResults">æ¸…ç©ºç»“æœ</span>
                            </button>
                            <button class="btn btn-primary" id="exportResultsBtn">
                                <i class="fas fa-download"></i> <span data-i18n="exportResults">å¯¼å‡ºç»“æœ</span>
                            </button>
                            <button class="btn btn-success" id="simulateScanBtn">
                                <i class="fas fa-bolt"></i> <span data-i18n="simulateScan">æ¨¡æ‹Ÿæ‰«æ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ–‡ä»¶é¢„è§ˆæ¨¡æ€æ¡† -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="filePreview">æ–‡ä»¶é¢„è§ˆ</h3>
                <button class="close-btn" id="closePreviewBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p data-i18n="previewDesc">æ–‡ä»¶å†…å®¹é¢„è§ˆï¼ˆæœ€å¤šæ˜¾ç¤ºå‰100è¡Œï¼‰ï¼š</p>
                <div class="sn-preview" id="snPreview"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPreviewBtn" data-i18n="cancel">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmUploadBtn" data-i18n="confirmUpload">ç¡®è®¤ä¸Šä¼ </button>
            </div>
        </div>
    </div>
    
    <script>
        // è¯­è¨€æ–‡æœ¬å®šä¹‰ï¼ˆç®€åŒ–ä¸ºä¸­è¶ŠåŒè¯­æ ¸å¿ƒåŠŸèƒ½ï¼‰
        const translations = {
            zh: {
                "dataSource": "æ•°æ®æºç®¡ç†",
                "uploadTitle": "ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ ",
                "uploadFormat": "æ”¯æŒ.txtã€.csvæ–‡ä»¶æ ¼å¼",
                "uploadHint": "æ¯è¡Œä¸€ä¸ªSNï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡10MB",
                "snList": "SNåˆ—è¡¨",
                "clearData": "æ¸…ç©º",
                "noData": "æš‚æ— æ•°æ®ï¼Œè¯·å…ˆä¸Šä¼ æ–‡ä»¶",
                "scanWindow": "æ‰«æçª—å£",
                "manualInput": "æ‰‹åŠ¨/æ‰«ç æª",
                "cameraScan": "æ‘„åƒå¤´æ‰«æ",
                "ready": "å°±ç»ª",
                "scanHint": "æç¤ºï¼šæ‰«æåæŒ‰å›è½¦é”®ç¡®è®¤ï¼Œæˆ–ä½¿ç”¨æ‰«ç æªè‡ªåŠ¨è¾“å…¥",
                "scanSettings": "æ‰«æè®¾ç½®",
                "preventDuplicate": "ç¦æ­¢é‡å¤æ‰«æ",
                "voiceAlert": "è¯­éŸ³æ’­æŠ¥",
                "highSpeedScan": "é«˜é€Ÿæ‰«ææ¨¡å¼",
                "cameraLoading": "æ­£åœ¨å¯åŠ¨æ‘„åƒå¤´...",
                "cameraHint": "å°†æ¡å½¢ç /äºŒç»´ç å¯¹å‡†æ‰«ææ¡†",
                "stopCamera": "åœæ­¢",
                "scanResults": "æ‰«æç»“æœ",
                "total": "æ€»è®¡",
                "noResults": "æš‚æ— æ‰«æç»“æœ",
                "clearResults": "æ¸…ç©ºç»“æœ",
                "exportResults": "å¯¼å‡ºç»“æœ",
                "simulateScan": "æ¨¡æ‹Ÿæ‰«æ",
                "filePreview": "æ–‡ä»¶é¢„è§ˆ",
                "previewDesc": "æ–‡ä»¶å†…å®¹é¢„è§ˆï¼ˆæœ€å¤šæ˜¾ç¤ºå‰100è¡Œï¼‰ï¼š",
                "cancel": "å–æ¶ˆ",
                "confirmUpload": "ç¡®è®¤ä¸Šä¼ ",
                "readyStatus": "å°±ç»ª",
                "passStatus": "PASS",
                "failStatus": "FAIL",
                "duplicateAlert": "SN \"{sn}\" å·²æ‰«æè¿‡ï¼Œé‡å¤æ‰«æå·²å¿½ç•¥",
                "successImport": "æˆåŠŸå¯¼å…¥ {count} ä¸ªSN",
                "clearDataSource": "å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®æº",
                "clearResultsMsg": "å·²æ¸…ç©ºæ‰€æœ‰æ‰«æç»“æœ",
                "exportSuccess": "ç»“æœå·²å¯¼å‡ºä¸ºCSVæ–‡ä»¶",
                "simulateComplete": "æ¨¡æ‹Ÿæ‰«æå®Œæˆ",
                "deleteSN": "å·²åˆ é™¤SN: {sn}",
                "enableDuplicate": "å·²å¯ç”¨é‡å¤æ‰«ææ£€æµ‹",
                "disableDuplicate": "å·²ç¦ç”¨é‡å¤æ‰«ææ£€æµ‹",
                "enableVoice": "å·²å¯ç”¨è¯­éŸ³æ’­æŠ¥",
                "disableVoice": "å·²ç¦ç”¨è¯­éŸ³æ’­æŠ¥",
                "enableHighSpeed": "å·²å¯ç”¨é«˜é€Ÿæ‰«ææ¨¡å¼",
                "disableHighSpeed": "å·²ç¦ç”¨é«˜é€Ÿæ‰«ææ¨¡å¼",
                "cameraStarted": "æ‘„åƒå¤´å·²å¯åŠ¨",
                "cameraStopped": "æ‘„åƒå¤´å·²åœæ­¢",
                "scanSuccess": "æ‰«ææˆåŠŸ: {sn}",
                "scanPlaceholder": "è¯·ä½¿ç”¨æ‰«ç æªæ‰«æSNæˆ–æ‰‹åŠ¨è¾“å…¥",
                "cameraAccessError": "æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™",
                "cameraActive": "æ‰«æä¸­...",
                "cameraNotSupported": "æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒæ‘„åƒå¤´æˆ–æ‘„åƒå¤´è®¿é—®è¢«æ‹’ç»",
                "voiceTest": "è¯­éŸ³æµ‹è¯•",
                "voiceTestSuccess": "è¯­éŸ³æ’­æŠ¥æµ‹è¯•æˆåŠŸ",
                "voiceTestError": "è¯­éŸ³æ’­æŠ¥æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§",
                "voiceNotSupported": "æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½"
            },
            vi: {
                "dataSource": "Quáº£n lÃ½ nguá»“n dá»¯ liá»‡u",
                "uploadTitle": "Nháº¥p hoáº·c kÃ©o tháº£ tá»‡p",
                "uploadFormat": "Há»— trá»£ .txt, .csv",
                "uploadHint": "Má»—i dÃ²ng má»™t SN, tá»‘i Ä‘a 10MB",
                "snList": "Danh sÃ¡ch SN",
                "clearData": "XÃ³a",
                "noData": "ChÆ°a cÃ³ dá»¯ liá»‡u",
                "scanWindow": "Cá»­a sá»• quÃ©t",
                "manualInput": "Thá»§ cÃ´ng/MÃ¡y quÃ©t",
                "cameraScan": "Camera",
                "ready": "Sáºµn sÃ ng",
                "scanHint": "Nháº¥n Enter sau khi quÃ©t",
                "scanSettings": "CÃ i Ä‘áº·t",
                "preventDuplicate": "Cháº·n quÃ©t trÃ¹ng",
                "voiceAlert": "PhÃ¡t Ã¢m thanh",
                "highSpeedScan": "QuÃ©t tá»‘c Ä‘á»™ cao",
                "cameraLoading": "Äang khá»Ÿi Ä‘á»™ng camera...",
                "cameraHint": "HÆ°á»›ng mÃ£ váº¡ch vÃ o khung",
                "stopCamera": "Dá»«ng",
                "scanResults": "Káº¿t quáº£",
                "total": "Tá»•ng",
                "noResults": "ChÆ°a cÃ³ káº¿t quáº£",
                "clearResults": "XÃ³a káº¿t quáº£",
                "exportResults": "Xuáº¥t káº¿t quáº£",
                "simulateScan": "MÃ´ phá»ng",
                "filePreview": "Xem trÆ°á»›c",
                "previewDesc": "Xem trÆ°á»›c ná»™i dung:",
                "cancel": "Há»§y",
                "confirmUpload": "XÃ¡c nháº­n",
                "readyStatus": "Sáºµn sÃ ng",
                "passStatus": "Äáº T",
                "failStatus": "Lá»–I",
                "duplicateAlert": "SN \"{sn}\" Ä‘Ã£ quÃ©t",
                "successImport": "ÄÃ£ nháº­p {count} SN",
                "clearDataSource": "ÄÃ£ xÃ³a dá»¯ liá»‡u",
                "clearResultsMsg": "ÄÃ£ xÃ³a káº¿t quáº£",
                "exportSuccess": "ÄÃ£ xuáº¥t CSV",
                "simulateComplete": "MÃ´ phá»ng hoÃ n táº¥t",
                "deleteSN": "ÄÃ£ xÃ³a SN: {sn}",
                "enableDuplicate": "Báº­t cháº·n trÃ¹ng",
                "disableDuplicate": "Táº¯t cháº·n trÃ¹ng",
                "enableVoice": "Báº­t phÃ¡t Ã¢m thanh",
                "disableVoice": "Táº¯t phÃ¡t Ã¢m thanh",
                "enableHighSpeed": "Báº­t quÃ©t nhanh",
                "disableHighSpeed": "Táº¯t quÃ©t nhanh",
                "cameraStarted": "Camera Ä‘Ã£ báº­t",
                "cameraStopped": "Camera Ä‘Ã£ táº¯t",
                "scanSuccess": "QuÃ©t thÃ nh cÃ´ng: {sn}",
                "scanPlaceholder": "QuÃ©t SN hoáº·c nháº­p thá»§ cÃ´ng",
                "cameraAccessError": "Lá»—i truy cáº­p camera",
                "cameraActive": "Äang quÃ©t...",
                "cameraNotSupported": "Thiáº¿t bá»‹ khÃ´ng há»— trá»£ camera hoáº·c quyá»n bá»‹ tá»« chá»‘i",
                "voiceTest": "Kiá»ƒm tra Ã¢m thanh",
                "voiceTestSuccess": "Kiá»ƒm tra Ã¢m thanh thÃ nh cÃ´ng",
                "voiceTestError": "Kiá»ƒm tra Ã¢m thanh tháº¥t báº¡i",
                "voiceNotSupported": "TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ phÃ¡t Ã¢m thanh"
            }
        };
        
        // å…¨å±€å˜é‡
        let snDataSource = new Set();
        let scannedResults = [];
        let currentFileContent = null;
        let lastScanTime = 0;
        let scannedSNs = new Set();
        let preventDuplicate = true;
        let enableVoice = true;
        let highSpeedScan = true;
        let currentLanguage = 'zh';
        let html5QrCode = null;
        let isCameraActive = false;
        let currentScanMode = 'manual';
        let speechSynthesis = window.speechSynthesis;
        let isVoiceSupported = false;
        let lastVoiceTime = 0;
        
        // DOMå…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const snItems = document.getElementById('snItems');
        const snCount = document.getElementById('snCount');
        const clearDataBtn = document.getElementById('clearDataBtn');
        const scanInput = document.getElementById('scanInput');
        const resultsList = document.getElementById('resultsList');
        const totalScanned = document.getElementById('totalScanned');
        const passCount = document.getElementById('passCount');
        const failCount = document.getElementById('failCount');
        const clearResultsBtn = document.getElementById('clearResultsBtn');
        const exportResultsBtn = document.getElementById('exportResultsBtn');
        const simulateScanBtn = document.getElementById('simulateScanBtn');
        const previewModal = document.getElementById('previewModal');
        const snPreview = document.getElementById('snPreview');
        const closePreviewBtn = document.getElementById('closePreviewBtn');
        const cancelPreviewBtn = document.getElementById('cancelPreviewBtn');
        const confirmUploadBtn = document.getElementById('confirmUploadBtn');
        const preventDuplicateSwitch = document.getElementById('preventDuplicateSwitch');
        const voiceSwitch = document.getElementById('voiceSwitch');
        const highSpeedSwitch = document.getElementById('highSpeedSwitch');
        const statusText = document.getElementById('statusText');
        const currentLangBtn = document.getElementById('currentLangBtn');
        const currentLangText = document.getElementById('currentLangText');
        const langOptions = document.getElementById('langOptions');
        const manualModeBtn = document.getElementById('manualModeBtn');
        const cameraModeBtn = document.getElementById('cameraModeBtn');
        const cameraContainer = document.getElementById('cameraContainer');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const cameraStatus = document.getElementById('camera-status');
        const cameraPreview = document.getElementById('camera-preview');
        const voiceTestBtn = document.getElementById('voiceTestBtn');
        const testVoicePassBtn = document.getElementById('testVoicePassBtn');
        const testVoiceFailBtn = document.getElementById('testVoiceFailBtn');
        const testVoiceDuplicateBtn = document.getElementById('testVoiceDuplicateBtn');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æµ‹è¯­éŸ³åˆæˆæ”¯æŒ
            checkVoiceSupport();
            
            // åŠ è½½ç¤ºä¾‹æ•°æ®
            loadExampleData();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEvents();
            
            // åˆå§‹åŒ–è®¾ç½®
            preventDuplicate = preventDuplicateSwitch.checked;
            enableVoice = voiceSwitch.checked;
            highSpeedScan = highSpeedSwitch.checked;
            
            // æ›´æ–°æ‰«æè¾“å…¥æ¡†å ä½ç¬¦
            updateScanPlaceholder();
            
            // åˆå§‹åŒ–è¯­è¨€
            initLanguage();
            
            // è‡ªåŠ¨èšç„¦åˆ°æ‰«æè¾“å…¥æ¡†
            scanInput.focus();
        });
        
        // æ£€æµ‹è¯­éŸ³åˆæˆæ”¯æŒ
        function checkVoiceSupport() {
            isVoiceSupported = !!speechSynthesis;
            
            if (!isVoiceSupported) {
                console.warn("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½");
                voiceSwitch.disabled = true;
                voiceSwitch.checked = false;
                enableVoice = false;
                
                // æ˜¾ç¤ºè­¦å‘Š
                const voiceTestArea = document.getElementById('voiceTestBtn');
                if (voiceTestArea) {
                    voiceTestArea.innerHTML += `
                        <div style="color: var(--warning-color); font-size: 11px; margin-top: 5px;">
                            <i class="fas fa-exclamation-triangle"></i> ${translate('voiceNotSupported')}
                        </div>
                    `;
                }
            }
        }
        
        // è¯­éŸ³æ’­æŠ¥å‡½æ•°
        function speakText(text) {
            if (!enableVoice || !isVoiceSupported) return;
            
            // é˜²æ­¢è¯­éŸ³æ’­æŠ¥è¿‡äºé¢‘ç¹ï¼ˆè‡³å°‘é—´éš”500msï¼‰
            const now = Date.now();
            if (now - lastVoiceTime < 500) return;
            lastVoiceTime = now;
            
            try {
                // åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
                speechSynthesis.cancel();
                
                // åˆ›å»ºè¯­éŸ³å®ä¾‹
                const utterance = new SpeechSynthesisUtterance(text);
                
                // è®¾ç½®è¯­è¨€
                utterance.lang = currentLanguage === 'zh' ? 'zh-CN' : 'vi-VN';
                
                // è®¾ç½®è¯­é€Ÿå’ŒéŸ³é‡
                utterance.rate = 0.9;
                utterance.volume = 1.0;
                utterance.pitch = 1.0;
                
                // æ’­æ”¾è¯­éŸ³
                speechSynthesis.speak(utterance);
                
                // è¯­éŸ³æ’­æ”¾å®Œæˆåçš„å¤„ç†
                utterance.onend = function() {
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è¯­éŸ³æ’­æ”¾å®Œæˆåçš„é€»è¾‘
                };
                
                utterance.onerror = function(event) {
                    console.error("è¯­éŸ³æ’­æŠ¥é”™è¯¯:", event);
                };
            } catch (error) {
                console.error("è¯­éŸ³æ’­æŠ¥å¤±è´¥:", error);
                isVoiceSupported = false;
                voiceSwitch.checked = false;
                enableVoice = false;
            }
        }
        
        // æ ¹æ®æ‰«æç»“æœæ’­æ”¾è¯­éŸ³
        function playVoiceByResult(resultType) {
            if (!enableVoice || !isVoiceSupported) return;
            
            let text = '';
            
            switch (resultType) {
                case 'pass':
                    text = currentLanguage === 'zh' ? 'PASS' : 'Äáº T';
                    break;
                case 'fail':
                    text = currentLanguage === 'zh' ? 'FAIL' : 'Lá»–I';
                    break;
                case 'duplicate':
                    text = currentLanguage === 'zh' ? 'é‡å¤æ‰«æ' : 'QuÃ©t trÃ¹ng';
                    break;
            }
            
            if (text) {
                speakText(text);
            }
        }
        
        // åˆå§‹åŒ–è¯­è¨€
        function initLanguage() {
            // ä»æœ¬åœ°å­˜å‚¨è·å–è¯­è¨€è®¾ç½®
            const savedLang = localStorage.getItem('snScannerLang');
            if (savedLang && translations[savedLang]) {
                currentLanguage = savedLang;
            }
            
            // æ›´æ–°ç•Œé¢è¯­è¨€
            updateLanguage();
            
            // è®¾ç½®è¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            currentLangBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                langOptions.classList.toggle('show');
            });
            
            // è¯­è¨€é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.lang-option').forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    switchLanguage(lang);
                    langOptions.classList.remove('show');
                });
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­è¯­è¨€é€‰é¡¹
            document.addEventListener('click', function() {
                langOptions.classList.remove('show');
            });
        }
        
        // åˆ‡æ¢è¯­è¨€
        function switchLanguage(lang) {
            if (!translations[lang]) return;
            
            currentLanguage = lang;
            localStorage.setItem('snScannerLang', lang);
            updateLanguage();
        }
        
        // æ›´æ–°ç•Œé¢è¯­è¨€
        function updateLanguage() {
            // æ›´æ–°è¯­è¨€æŒ‰é’®æ–‡æœ¬
            const langNames = {
                'zh': 'ä¸­æ–‡',
                'vi': 'Tiáº¿ng Viá»‡t'
            };
            currentLangText.textContent = langNames[currentLanguage];
            
            // æ›´æ–°æ‰€æœ‰å¸¦data-i18nå±æ€§çš„å…ƒç´ 
            updateLanguageElements();
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            statusText.textContent = translate('readyStatus');
            
            // æ›´æ–°ç»“æœåˆ—è¡¨ä¸­çš„æ—¶é—´æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ç»“æœï¼‰
            if (scannedResults.length > 0) {
                updateResultsList();
            }
        }
        
        // æ›´æ–°è¯­è¨€å…ƒç´ 
        function updateLanguageElements() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLanguage][key]) {
                    let text = translations[currentLanguage][key];
                    
                    // å¦‚æœæ˜¯æ‰«æè¾“å…¥æ¡†å ä½ç¬¦
                    if (element.id === 'scanInput') {
                        element.placeholder = text;
                    } else {
                        element.textContent = text;
                    }
                }
            });
        }
        
        // ç¿»è¯‘æ–‡æœ¬ï¼ˆæ”¯æŒå¸¦å‚æ•°ï¼‰
        function translate(key, params = {}) {
            let text = translations[currentLanguage][key] || translations['zh'][key] || key;
            
            // æ›¿æ¢å‚æ•°
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            
            return text;
        }
        
        // æ›´æ–°æ‰«æè¾“å…¥æ¡†å ä½ç¬¦
        function updateScanPlaceholder() {
            scanInput.placeholder = translate('scanPlaceholder');
        }
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æ–‡ä»¶ä¸Šä¼ ç›¸å…³äº‹ä»¶
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleFileDrop);
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ•°æ®æºç®¡ç†äº‹ä»¶
            clearDataBtn.addEventListener('click', clearDataSource);
            
            // æ‰«æç›¸å…³äº‹ä»¶
            scanInput.addEventListener('keydown', handleScanInput);
            
            // æ‰«ææ¨¡å¼åˆ‡æ¢
            manualModeBtn.addEventListener('click', () => switchScanMode('manual'));
            cameraModeBtn.addEventListener('click', () => switchScanMode('camera'));
            
            // æ‘„åƒå¤´æ§åˆ¶
            stopCameraBtn.addEventListener('click', stopCamera);
            
            // è®¾ç½®ç›¸å…³äº‹ä»¶
            preventDuplicateSwitch.addEventListener('change', function() {
                preventDuplicate = this.checked;
                showToast(
                    this.checked ? translate('enableDuplicate') : translate('disableDuplicate'), 
                    "info"
                );
            });
            
            voiceSwitch.addEventListener('change', function() {
                enableVoice = this.checked && isVoiceSupported;
                showToast(
                    this.checked ? translate('enableVoice') : translate('disableVoice'), 
                    "info"
                );
            });
            
            highSpeedSwitch.addEventListener('change', function() {
                highSpeedScan = this.checked;
                showToast(
                    this.checked ? translate('enableHighSpeed') : translate('disableHighSpeed'), 
                    "info"
                );
            });
            
            // è¯­éŸ³æµ‹è¯•æŒ‰é’®äº‹ä»¶
            testVoicePassBtn.addEventListener('click', function() {
                playVoiceByResult('pass');
                showToast(translate('voiceTestSuccess'), "success");
            });
            
            testVoiceFailBtn.addEventListener('click', function() {
                playVoiceByResult('fail');
                showToast(translate('voiceTestSuccess'), "success");
            });
            
            testVoiceDuplicateBtn.addEventListener('click', function() {
                playVoiceByResult('duplicate');
                showToast(translate('voiceTestSuccess'), "success");
            });
            
            // ç»“æœç®¡ç†äº‹ä»¶
            clearResultsBtn.addEventListener('click', clearScanResults);
            exportResultsBtn.addEventListener('click', exportResults);
            simulateScanBtn.addEventListener('click', simulateScanner);
            
            // æ¨¡æ€æ¡†äº‹ä»¶
            closePreviewBtn.addEventListener('click', () => previewModal.style.display = 'none');
            cancelPreviewBtn.addEventListener('click', () => previewModal.style.display = 'none');
            confirmUploadBtn.addEventListener('click', confirmFileUpload);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            previewModal.addEventListener('click', function(e) {
                if (e.target === previewModal) {
                    previewModal.style.display = 'none';
                }
            });
            
            // é¡µé¢å¸è½½æ—¶åœæ­¢æ‘„åƒå¤´å’Œè¯­éŸ³
            window.addEventListener('beforeunload', function() {
                if (isCameraActive && html5QrCode) {
                    try {
                        html5QrCode.stop();
                    } catch (e) {
                        // å¿½ç•¥é”™è¯¯
                    }
                }
                
                // åœæ­¢è¯­éŸ³æ’­æ”¾
                if (speechSynthesis) {
                    speechSynthesis.cancel();
                }
            });
        }
        
        // åˆ‡æ¢æ‰«ææ¨¡å¼
        function switchScanMode(mode) {
            if (currentScanMode === mode) return;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            manualModeBtn.classList.remove('active');
            cameraModeBtn.classList.remove('active');
            
            if (mode === 'manual') {
                manualModeBtn.classList.add('active');
                cameraContainer.style.display = 'none';
                scanInput.disabled = false;
                scanInput.focus();
                
                // å¦‚æœæ‘„åƒå¤´æ­£åœ¨è¿è¡Œï¼Œåœæ­¢å®ƒ
                if (isCameraActive) {
                    stopCamera();
                }
            } else if (mode === 'camera') {
                cameraModeBtn.classList.add('active');
                cameraContainer.style.display = 'block';
                scanInput.disabled = true;
                
                // å¯åŠ¨æ‘„åƒå¤´
                startCamera();
            }
            
            currentScanMode = mode;
        }
        
        // å¯åŠ¨æ‘„åƒå¤´ï¼ˆä¿®å¤ç‰ˆï¼‰
        async function startCamera() {
            // å¦‚æœå·²ç»æ¿€æ´»ï¼Œå…ˆåœæ­¢
            if (isCameraActive && html5QrCode) {
                await stopCamera();
            }
            
            try {
                // æ›´æ–°æ‘„åƒå¤´çŠ¶æ€æ˜¾ç¤º
                cameraStatus.innerHTML = `
                    <i class="fas fa-camera" style="font-size: 36px; margin-bottom: 12px;"></i>
                    <p>${translate('cameraLoading')}</p>
                `;
                cameraStatus.style.display = 'flex';
                
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ‘„åƒå¤´
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error(translate('cameraNotSupported'));
                }
                
                // åˆå§‹åŒ–html5QrCodeæ‰«æå™¨
                if (!html5QrCode) {
                    html5QrCode = new Html5Qrcode("camera-preview");
                }
                
                // é…ç½®æ‘„åƒå¤´
                const cameraConfig = {
                    fps: highSpeedScan ? 30 : 15,
                    qrbox: { width: 220, height: 120 },
                    aspectRatio: 1.0,
                    disableFlip: false
                };
                
                // å°è¯•å¯åŠ¨åç½®æ‘„åƒå¤´
                try {
                    await html5QrCode.start(
                        { facingMode: "environment" },
                        cameraConfig,
                        onCameraScanSuccess,
                        onCameraScanFailure
                    );
                } catch (rearCameraError) {
                    console.log("åç½®æ‘„åƒå¤´å¯åŠ¨å¤±è´¥ï¼Œå°è¯•å‰ç½®æ‘„åƒå¤´:", rearCameraError);
                    // å¦‚æœåç½®æ‘„åƒå¤´å¤±è´¥ï¼Œå°è¯•å‰ç½®æ‘„åƒå¤´
                    await html5QrCode.start(
                        { facingMode: "user" },
                        cameraConfig,
                        onCameraScanSuccess,
                        onCameraScanFailure
                    );
                }
                
                // æ›´æ–°çŠ¶æ€
                isCameraActive = true;
                cameraStatus.style.display = 'none';
                statusText.textContent = translate('cameraActive');
                statusText.style.color = "var(--primary-color)";
                showToast(translate('cameraStarted'), "success");
                
            } catch (error) {
                console.error("å¯åŠ¨æ‘„åƒå¤´å¤±è´¥:", error);
                
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                cameraStatus.innerHTML = `
                    <div class="camera-error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>${translate('cameraAccessError')}</p>
                        <p style="font-size: 11px; margin-top: 5px;">${error.message || ''}</p>
                        <button class="btn btn-primary btn-sm" id="retryCameraBtn" style="margin-top: 10px;">
                            <i class="fas fa-redo"></i> é‡è¯•
                        </button>
                    </div>
                `;
                
                // æ·»åŠ é‡è¯•æŒ‰é’®äº‹ä»¶
                document.getElementById('retryCameraBtn')?.addEventListener('click', startCamera);
                
                showToast(translate('cameraAccessError'), "error");
                
                // åˆ‡æ¢å›æ‰‹åŠ¨æ¨¡å¼
                setTimeout(() => {
                    switchScanMode('manual');
                }, 3000);
            }
        }
        
        // åœæ­¢æ‘„åƒå¤´
        async function stopCamera() {
            if (!html5QrCode || !isCameraActive) return;
            
            try {
                await html5QrCode.stop();
                isCameraActive = false;
                cameraStatus.style.display = 'flex';
                cameraStatus.innerHTML = `
                    <i class="fas fa-camera" style="font-size: 36px; margin-bottom: 12px;"></i>
                    <p>${translate('cameraLoading')}</p>
                `;
                statusText.textContent = translate('readyStatus');
                statusText.style.color = "";
                showToast(translate('cameraStopped'), "info");
            } catch (error) {
                console.error("åœæ­¢æ‘„åƒå¤´å¤±è´¥:", error);
                // å³ä½¿åœæ­¢å¤±è´¥ï¼Œä¹Ÿæ›´æ–°çŠ¶æ€
                isCameraActive = false;
                cameraStatus.style.display = 'flex';
                cameraStatus.innerHTML = `
                    <i class="fas fa-camera" style="font-size: 36px; margin-bottom: 12px;"></i>
                    <p>${translate('cameraLoading')}</p>
                `;
                statusText.textContent = translate('readyStatus');
                statusText.style.color = "";
            }
        }
        
        // æ‘„åƒå¤´æ‰«ææˆåŠŸå›è°ƒ
        function onCameraScanSuccess(decodedText, decodedResult) {
            // é˜²æ­¢é¢‘ç¹è§¦å‘
            const now = Date.now();
            if (now - lastScanTime < 300) return;
            lastScanTime = now;
            
            const sn = decodedText.trim();
            if (!sn) return;
            
            // æ˜¾ç¤ºæ‰«ææˆåŠŸæç¤º
            showToast(translate('scanSuccess', {sn: sn}), "success");
            
            // æ£€æŸ¥æ˜¯å¦ç¦æ­¢é‡å¤æ‰«æ
            if (preventDuplicate && scannedSNs.has(sn)) {
                showDuplicateAlert(sn);
                playVoiceByResult('duplicate');
                return;
            }
            
            // æ£€æŸ¥SNæ˜¯å¦åœ¨æ•°æ®æºä¸­
            const isPass = snDataSource.has(sn);
            
            // æ·»åŠ åˆ°å·²æ‰«æé›†åˆ
            scannedSNs.add(sn);
            
            // æ·»åŠ åˆ°æ‰«æç»“æœ
            addScanResult(sn, isPass);
            
            // æ’­æ”¾è¯­éŸ³æç¤º
            playVoiceByResult(isPass ? 'pass' : 'fail');
        }
        
        // æ‘„åƒå¤´æ‰«æå¤±è´¥å›è°ƒ
        function onCameraScanFailure(error) {
            // è¿™é‡Œå¯ä»¥å¤„ç†æ‰«æå¤±è´¥çš„æƒ…å†µï¼Œä½†é€šå¸¸ä¸éœ€è¦ç‰¹åˆ«å¤„ç†
            // console.log("æ‰«æå¤±è´¥:", error);
        }
        
        // å¤„ç†æ‹–æ‹½æ–‡ä»¶
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary-color)';
            uploadArea.style.backgroundColor = 'rgba(24, 144, 255, 0.04)';
        }
        
        function handleFileDrop(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#d9d9d9';
            uploadArea.style.backgroundColor = '#fafafa';
            
            if (e.dataTransfer.files.length) {
                const file = e.dataTransfer.files[0];
                previewFile(file);
            }
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            if (e.target.files.length) {
                const file = e.target.files[0];
                previewFile(file);
            }
        }
        
        // é¢„è§ˆæ–‡ä»¶å†…å®¹
        function previewFile(file) {
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const validExtensions = ['.txt', '.csv'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!validExtensions.includes(fileExtension)) {
                alert(currentLanguage === 'vi' ? 
                    'Vui lÃ²ng táº£i lÃªn tá»‡p Ä‘á»‹nh dáº¡ng .txt hoáº·c .csv' : 
                    'è¯·ä¸Šä¼ .txtæˆ–.csvæ ¼å¼çš„æ–‡ä»¶');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶10MBï¼‰
            if (file.size > 10 * 1024 * 1024) {
                alert(currentLanguage === 'vi' ? 
                    'KÃ­ch thÆ°á»›c tá»‡p khÃ´ng Ä‘Æ°á»£c vÆ°á»£t quÃ¡ 10MB' : 
                    'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                currentFileContent = {
                    name: file.name,
                    size: formatFileSize(file.size),
                    content: e.target.result
                };
                
                // æ˜¾ç¤ºé¢„è§ˆ
                showFilePreview();
            };
            
            reader.onerror = function() {
                alert(currentLanguage === 'vi' ? 
                    'Äá»c tá»‡p tháº¥t báº¡i, vui lÃ²ng thá»­ láº¡i' : 
                    'æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
        function showFilePreview() {
            if (!currentFileContent) return;
            
            // è§£ææ–‡ä»¶å†…å®¹
            const lines = currentFileContent.content.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            // æ˜¾ç¤ºé¢„è§ˆå†…å®¹ï¼ˆæœ€å¤š100è¡Œï¼‰
            const previewLines = lines.slice(0, 100);
            let previewHTML = '';
            
            previewLines.forEach((line, index) => {
                previewHTML += `<div class="sn-preview-item">${index + 1}. ${line}</div>`;
            });
            
            if (lines.length > 100) {
                previewHTML += `<div class="sn-preview-item">... ${
                    currentLanguage === 'vi' ? `vÃ  ${lines.length - 100} SN khÃ¡c` : 
                    `ä»¥åŠ ${lines.length - 100} ä¸ªæ›´å¤šSN`
                }</div>`;
            }
            
            snPreview.innerHTML = previewHTML;
            previewModal.style.display = 'flex';
        }
        
        // ç¡®è®¤ä¸Šä¼ æ–‡ä»¶
        function confirmFileUpload() {
            if (!currentFileContent) return;
            
            // è§£ææ–‡ä»¶å†…å®¹
            const lines = currentFileContent.content.split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            // æ·»åŠ åˆ°æ•°æ®æº
            const addedCount = lines.length;
            const duplicateCount = lines.filter(sn => snDataSource.has(sn)).length;
            const newCount = addedCount - duplicateCount;
            
            lines.forEach(sn => {
                snDataSource.add(sn);
            });
            
            // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
            addFileToList(currentFileContent.name, currentFileContent.size, lines.length, duplicateCount);
            
            // æ›´æ–°SNåˆ—è¡¨æ˜¾ç¤º
            updateSnList();
            
            // å…³é—­æ¨¡æ€æ¡†
            previewModal.style.display = 'none';
            currentFileContent = null;
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            fileInput.value = '';
            
            // æ˜¾ç¤ºä¸Šä¼ æˆåŠŸæ¶ˆæ¯
            showToast(
                translate('successImport', {count: addedCount}), 
                "success"
            );
        }
        
        // æ·»åŠ æ–‡ä»¶åˆ°åˆ—è¡¨
        function addFileToList(fileName, fileSize, snCount, duplicateCount = 0) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const duplicateText = currentLanguage === 'vi' ? 
                `(${duplicateCount} trÃ¹ng)` : 
                `(${duplicateCount}é‡å¤)`;
            
            const duplicateInfo = duplicateCount > 0 ? 
                `<span style="color:var(--warning-color); font-size:11px;">${duplicateText}</span>` : '';
            
            fileItem.innerHTML = `
                <i class="fas fa-file-alt"></i>
                <div class="file-info">
                    <div class="file-name">${fileName}</div>
                    <div class="file-size">${fileSize} Â· ${snCount} ${
                        currentLanguage === 'vi' ? 'SN' : 'ä¸ªSN'
                    } ${duplicateInfo}</div>
                </div>
                <div class="file-actions">
                    <button class="btn-icon" title="${currentLanguage === 'vi' ? 'Xem' : 'æŸ¥çœ‹'}">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon" title="${currentLanguage === 'vi' ? 'XÃ³a' : 'åˆ é™¤'}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬
            const deleteBtn = fileItem.querySelector('.fa-trash-alt').closest('.btn-icon');
            deleteBtn.addEventListener('click', function() {
                fileItem.remove();
                // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œä¸å®é™…ä»æ•°æ®æºä¸­åˆ é™¤SN
            });
            
            fileList.appendChild(fileItem);
        }
        
        // æ›´æ–°SNåˆ—è¡¨æ˜¾ç¤º
        function updateSnList() {
            snCount.textContent = snDataSource.size;
            
            if (snDataSource.size === 0) {
                snItems.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <p>${translate('noData')}</p>
                    </div>
                `;
                return;
            }
            
            // æ˜¾ç¤ºå‰30ä¸ªSNï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
            const snArray = Array.from(snDataSource);
            const displayCount = Math.min(snArray.length, 30);
            
            let snItemsHTML = '';
            
            for (let i = 0; i < displayCount; i++) {
                snItemsHTML += `
                    <div class="sn-item">
                        <i class="fas fa-hashtag"></i>
                        <span class="sn-text">${snArray[i]}</span>
                    </div>
                `;
            }
            
            if (snArray.length > 30) {
                const moreText = currentLanguage === 'vi' ? 
                    `... vÃ  ${snArray.length - 30} SN khÃ¡c` : 
                    `... è¿˜æœ‰ ${snArray.length - 30} ä¸ªSN`;
                
                snItemsHTML += `
                    <div class="sn-item" style="justify-content: center; color: var(--text-secondary); font-size: 12px;">
                        ${moreText}
                    </div>
                `;
            }
            
            snItems.innerHTML = snItemsHTML;
        }
        
        // æ¸…ç©ºæ•°æ®æº
        function clearDataSource() {
            if (snDataSource.size === 0) return;
            
            const confirmMsg = currentLanguage === 'vi' ? 
                'Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a táº¥t cáº£ nguá»“n dá»¯ liá»‡u?' :
                'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®æºå—ï¼Ÿ';
            
            if (confirm(confirmMsg)) {
                snDataSource.clear();
                scannedSNs.clear();
                fileList.innerHTML = '';
                updateSnList();
                showToast(translate('clearDataSource'), "info");
            }
        }
        
        // å¤„ç†æ‰«æè¾“å…¥
        function handleScanInput(e) {
            // æŒ‰ä¸‹å›è½¦é”®å¤„ç†æ‰«æ
            if (e.key === 'Enter') {
                e.preventDefault();
                processScan();
            }
        }
        
        // å¤„ç†æ‰«æ
        function processScan() {
            const sn = scanInput.value.trim();
            
            if (!sn) return;
            
            // é˜²æ­¢é‡å¤å¿«é€Ÿæ‰«æï¼ˆ300mså†…ï¼‰
            const now = Date.now();
            if (now - lastScanTime < 300) {
                scanInput.value = '';
                return;
            }
            
            lastScanTime = now;
            
            // æ£€æŸ¥æ˜¯å¦ç¦æ­¢é‡å¤æ‰«æ
            if (preventDuplicate && scannedSNs.has(sn)) {
                showDuplicateAlert(sn);
                playVoiceByResult('duplicate');
                scanInput.value = '';
                scanInput.focus();
                return;
            }
            
            // æ£€æŸ¥SNæ˜¯å¦åœ¨æ•°æ®æºä¸­
            const isPass = snDataSource.has(sn);
            
            // æ·»åŠ åˆ°å·²æ‰«æé›†åˆ
            scannedSNs.add(sn);
            
            // æ·»åŠ åˆ°æ‰«æç»“æœ
            addScanResult(sn, isPass);
            
            // æ’­æ”¾è¯­éŸ³æç¤º
            playVoiceByResult(isPass ? 'pass' : 'fail');
            
            // æ¸…ç©ºè¾“å…¥æ¡†å¹¶èšç„¦
            scanInput.value = '';
            scanInput.focus();
            
            // æ›´æ–°ç»Ÿè®¡
            updateStats();
        }
        
        // æ˜¾ç¤ºé‡å¤æ‰«ææç¤º
        function showDuplicateAlert(sn) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'duplicate-alert';
            alertDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                <span>${translate('duplicateAlert', {sn: sn})}</span>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 2ç§’åç§»é™¤æç¤º
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 2000);
        }
        
        // æ·»åŠ æ‰«æç»“æœ
        function addScanResult(sn, isPass) {
            const result = {
                id: scannedResults.length + 1,
                sn: sn,
                isPass: isPass,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                mode: currentScanMode
            };
            
            // æ·»åŠ åˆ°ç»“æœæ•°ç»„å¼€å¤´ï¼ˆæœ€æ–°ç»“æœæ˜¾ç¤ºåœ¨æœ€ä¸Šé¢ï¼‰
            scannedResults.unshift(result);
            
            // é™åˆ¶ç»“æœæ•°é‡ï¼Œé¿å…å†…å­˜é—®é¢˜
            if (scannedResults.length > 100) {
                scannedResults = scannedResults.slice(0, 100);
            }
            
            // æ›´æ–°ç»“æœåˆ—è¡¨æ˜¾ç¤º
            updateResultsList();
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            statusText.textContent = isPass ? translate('passStatus') : translate('failStatus');
            statusText.style.color = isPass ? "var(--success-color)" : "var(--error-color)";
            statusText.style.fontWeight = "bold";
            
            // 2ç§’åæ¢å¤çŠ¶æ€æ–‡æœ¬
            setTimeout(() => {
                statusText.textContent = translate('readyStatus');
                statusText.style.color = "";
                statusText.style.fontWeight = "";
            }, 1500);
        }
        
        // æ›´æ–°ç»“æœåˆ—è¡¨æ˜¾ç¤º
        function updateResultsList() {
            if (scannedResults.length === 0) {
                resultsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-barcode"></i>
                        <p>${translate('noResults')}</p>
                    </div>
                `;
                return;
            }
            
            let resultsHTML = '';
            
            // åªæ˜¾ç¤ºå‰20ä¸ªç»“æœä»¥æé«˜æ€§èƒ½
            const displayResults = scannedResults.slice(0, 20);
            
            displayResults.forEach(result => {
                const resultText = result.isPass ? translate('passStatus') : translate('failStatus');
                const modeIcon = result.mode === 'camera' ? '<i class="fas fa-camera" style="margin-right: 4px; font-size: 10px; opacity: 0.7;"></i>' : '';
                
                resultsHTML += `
                    <div class="result-item">
                        <div class="result-status ${result.isPass ? 'pass' : 'fail'}">
                            <i class="fas fa-${result.isPass ? 'check' : 'times'}"></i>
                        </div>
                        <div class="result-details">
                            <div class="result-main">
                                <span class="result-sn">${modeIcon}${result.sn}</span>
                                <span class="result-text ${result.isPass ? 'pass' : 'fail'}">
                                    ${resultText}
                                </span>
                            </div>
                            <div class="result-time">
                                <i class="far fa-clock" style="font-size: 10px;"></i>
                                ${result.time}
                            </div>
                        </div>
                        <div class="result-actions">
                            <button class="btn-icon btn-sm" title="${currentLanguage === 'vi' ? 'QuÃ©t láº¡i' : 'é‡æ–°æ‰«æ'}">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="btn-icon btn-sm" title="${currentLanguage === 'vi' ? 'XÃ³a' : 'åˆ é™¤'}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            resultsList.innerHTML = resultsHTML;
            
            // æ·»åŠ æŒ‰é’®äº‹ä»¶
            addResultActions();
        }
        
        // æ·»åŠ ç»“æœé¡¹æŒ‰é’®äº‹ä»¶
        function addResultActions() {
            // é‡æ–°æ‰«ææŒ‰é’®
            resultsList.querySelectorAll('.fa-redo').forEach(icon => {
                icon.closest('.btn-icon').addEventListener('click', function() {
                    const resultItem = this.closest('.result-item');
                    const snText = resultItem.querySelector('.result-sn').textContent;
                    const sn = snText.replace(/[^\w\-]/g, ''); // ç§»é™¤å›¾æ ‡å­—ç¬¦
                    
                    // å°†SNå¡«å…¥è¾“å…¥æ¡†
                    scanInput.value = sn;
                    scanInput.focus();
                    switchScanMode('manual');
                });
            });
            
            // åˆ é™¤æŒ‰é’®
            resultsList.querySelectorAll('.fa-trash-alt').forEach(icon => {
                icon.closest('.btn-icon').addEventListener('click', function() {
                    const resultItem = this.closest('.result-item');
                    const snText = resultItem.querySelector('.result-sn').textContent;
                    const sn = snText.replace(/[^\w\-]/g, '');
                    
                    // ä»ç»“æœä¸­åˆ é™¤
                    const index = scannedResults.findIndex(r => r.sn === sn);
                    if (index !== -1) {
                        scannedResults.splice(index, 1);
                        // ä»å·²æ‰«æé›†åˆä¸­ç§»é™¤
                        scannedSNs.delete(sn);
                        updateResultsList();
                        updateStats();
                        showToast(translate('deleteSN', {sn: sn}), "info");
                    }
                });
            });
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const total = scannedResults.length;
            const pass = scannedResults.filter(r => r.isPass).length;
            const fail = total - pass;
            
            totalScanned.textContent = total;
            passCount.textContent = pass;
            failCount.textContent = fail;
        }
        
        // æ¸…ç©ºæ‰«æç»“æœ
        function clearScanResults() {
            if (scannedResults.length === 0) return;
            
            const confirmMsg = currentLanguage === 'vi' ? 
                'Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a táº¥t cáº£ káº¿t quáº£ quÃ©t?' :
                'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰«æç»“æœå—ï¼Ÿ';
            
            if (confirm(confirmMsg)) {
                scannedResults = [];
                scannedSNs.clear();
                updateResultsList();
                updateStats();
                showToast(translate('clearResultsMsg'), "info");
            }
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            if (scannedResults.length === 0) {
                alert(currentLanguage === 'vi' ? 
                    'KhÃ´ng cÃ³ káº¿t quáº£ quÃ©t Ä‘á»ƒ xuáº¥t' : 
                    'æ²¡æœ‰å¯å¯¼å‡ºçš„æ‰«æç»“æœ');
                return;
            }
            
            let csvContent = currentLanguage === 'vi' ? 
                "STT,SN,Káº¿t quáº£,Thá»i gian,PhÆ°Æ¡ng thá»©c\n" : 
                "åºå·,SN,ç»“æœ,æ—¶é—´,æ‰«ææ–¹å¼\n";
            
            scannedResults.forEach(result => {
                const resultText = result.isPass ? 
                    (currentLanguage === 'vi' ? "Äáº T" : "PASS") : 
                    (currentLanguage === 'vi' ? "Lá»–I" : "FAIL");
                const modeText = result.mode === 'camera' ? 
                    (currentLanguage === 'vi' ? "Camera" : "æ‘„åƒå¤´") : 
                    (currentLanguage === 'vi' ? "Thá»§ cÃ´ng" : "æ‰‹åŠ¨");
                csvContent += `${result.id},${result.sn},${resultText},${result.time},${modeText}\n`;
            });
            
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            const fileName = currentLanguage === 'vi' ? 
                `Ket_qua_quet_SN_${new Date().toLocaleDateString('vi-VN').replace(/\//g, '-')}.csv` :
                `SNæ‰«æç»“æœ_${new Date().toLocaleDateString().replace(/\//g, '-')}.csv`;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            showToast(translate('exportSuccess'), "success");
        }
        
        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadExampleData() {
            // ç¤ºä¾‹SNæ•°æ®
            const exampleSNs = [
                "SN20240001", "SN20240002", "SN20240003", "SN20240005", "SN20240007",
                "SN20240009", "SN20240012", "SN20240015", "SN20240018", "SN20240021",
                "SN20240024", "SN20240027", "SN20240030", "SN20240033", "SN20240036"
            ];
            
            // æ·»åŠ åˆ°æ•°æ®æº
            exampleSNs.forEach(sn => {
                snDataSource.add(sn);
            });
            
            // æ·»åŠ ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶
            const fileName = currentLanguage === 'vi' ? 'Dá»¯ liá»‡u máº«u.txt' : 'ç¤ºä¾‹æ•°æ®.txt';
            addFileToList(fileName, "1.2KB", exampleSNs.length);
            
            // æ›´æ–°æ˜¾ç¤º
            updateSnList();
        }
        
        // æ¨¡æ‹Ÿæ‰«ç æªè‡ªåŠ¨è¾“å…¥ï¼ˆæµ‹è¯•ç”¨ï¼‰
        function simulateScanner() {
            const testSNs = [
                "SN20240001", "SN20240002", "SN20240004", "SN20240005", 
                "SN20240007", "SN20240008", "SN20240009", "SN20240010",
                "SN20240001", "SN20240002", "SN20240012"
            ];
            
            let index = 0;
            
            const interval = setInterval(() => {
                if (index < testSNs.length) {
                    scanInput.value = testSNs[index];
                    processScan();
                    index++;
                } else {
                    clearInterval(interval);
                    showToast(translate('simulateComplete'), "success");
                }
            }, 800);
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type) {
            // ç§»é™¤å·²æœ‰çš„æ¶ˆæ¯
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            });
            
            // åˆ›å»ºæ–°æ¶ˆæ¯
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = currentLanguage === 'vi' ? 
                ['Bytes', 'KB', 'MB', 'GB'] : 
                ['å­—èŠ‚', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>